<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>2022_kenshu_w3-4: What is selogger?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">2022_kenshu_w3-4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'検索','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','検索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_Data_java8_selogger_doc_features_en.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">What is selogger? </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>selogger is a toolkit for recording an execution trace of a Java program.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Usage</h1>
<p>You must have a target Java application and a test case to execute the program.</p>
<ol type="1">
<li>Execute selogger.weaver.TraceWeaver to insert logging code into the target program.<ul>
<li>To execute TraceWeaver, please include selogger classes and all jar files in lib directory in -classpath.</li>
<li>TraceWeaver takes as input class file names, directory names and zip file names. <br  />
</li>
<li>If a directory name is specified, class files are listed up for weaving. If you want to automatically list up JAR files in a directory, specify <code>-jardir</code> option.</li>
<li>If you want to weave jar files in a jar file recursively, specify -innerJAR option.</li>
<li>TraceWeaver outputs woven files to the current directory. If you want to change a directory, please specify <code>-output=path/to/dir</code> option.</li>
<li>TraceWeaver weaves bytecode for JDK 1.7 and 1.8. If your program is JDK 1.6 or earlier, please specify <code>-jdk16</code>. Without the option, a woven program may cause a verify error.</li>
<li>TraceWeaver termintes if an error occurs during a weaving process. If you want to ignore errors, specify <code>-ignoreError</code>. The option skips weaving for class files that cause an error. Some applications, e.g. DaCapo benchmark, include an invalid class file intentionally. This option can ignore such a file. The weaving result is recorded in a log file.</li>
<li>If you want to specify events to be recorded, please specify <code>-weave=</code> option. <code>-weave=ALL</code> records all events. The option accepts 6 sub-options listed by commas (<code>EXEC,CALL,ARRAY,FILED,MISC,LABEL,PARAM</code>). Executions, method calls, array read/write, field read/write, some instructions (e.g. monitor entry/exit and instanceof), control-flow labels, and parameter values. By default, selogger records all events except for labels.</li>
</ul>
</li>
<li>Execute the woven target program with class files in selogger/bin directory. Other jar files in lib directory is unnecessary. You may specify the following options.<ul>
<li>-Dselogger.dir=log-directory-name specifies a directory for an execution trace. You should specify a disk that has enough space.</li>
<li>-Dselogger.threads=[0-8] specifies the number of background threads to write an execution trace into a disk. Each thread requires about 400MB RAM for a buffer. The default value is 0. If you have enough CPU power and fast disks, you may specify e.g. 2 or 4, to speed up an execution.</li>
<li>-Dselogger.errorlog=filename specifies an error log file. Since an execution trace may cause a disk full error, you may specify another directory from the trace directory. If not specified, an error log is not output.</li>
<li>-Dselogger.output=profile option outputs a frequency table of events instead of writing an execution trace. This option enables to estimate an execution trace size.</li>
</ul>
</li>
<li>Analyze an execution trace.<ul>
<li><a class="el" href="classselogger_1_1reader_1_1LogPrinter.html">selogger.reader.LogPrinter</a> is a basic program that simply print out the contents of an execution trace. The printer class takes <code>-dir=path/to/trace</code> option to specify an execution trace directory (that is specified as <code>-Dselogger.dir</code> directory).</li>
<li>Create your own analysis program with selogger.reader.LogDirectory and EventReader classes.</li>
</ul>
</li>
</ol>
<p><a class="el" href="testdata_8bat_8txt.html">testdata.bat.txt</a> is an example batch file for Windows to execute the three steps described above for testdata package in selogger. You may execute it by removing the extension .txt.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Features</h1>
<ul>
<li>TraceWeaver supports bytecode weaving for jar files.</li>
<li>Events recorded by this tool is listed in <code>events-en.html</code>.</li>
<li>TraceWeaver supports JDK 1.6, 1.7, and 1.8. 1.8 is experimental implementation.</li>
</ul>
<h1><a class="anchor" id="autotoc_md21"></a>
Data files generated by TraceWeaver</h1>
<ul>
<li>classes.txt contains a list of woven class files. Each line shows a sequential ID of a class, the jar/directory name of the class file, class file name, class name, weaving result, MD5 hash of the class binary.</li>
<li>If a weaving process encounters a runtime error, messages are recorded in log.txt.</li>
<li>LogLevel.IgnoreArrayInitializer: path/to/aClass.class indicates a method in the class is too large to insert logging code for array initialization.</li>
<li>LogLevel.OnlyEntryExit: path/to/aClass.class indicates a method in the class is too large to insert logging code. Only entry/exit events are recorded for the class.</li>
<li>Failed to weave ... message indicates TraceWeaver could not process a file. For example, TraceWeaver shows this message for org/apache/derbyTesting/databaseclassloader/emc.class in the DaCapo benchmark suite, because the file is a broken class file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
Event Stream</h1>
<ul>
<li>An execution trace of a single thread comprises a stream of events as follows. <pre class="fragment">  method ::= METHOD_ENTRY  FORMAL_PARAM*  instruction  (METHOD_NORMAL_EXIT|METHOD_EXCEPTIONAL_EXIT)
  instruction ::= METHOD_CALL  ACTUAL_PARAM*  method?  (RETURN_VALUE_AFTER_CALL|OBJECT_INITIALIZED|OBJECT_CREATION_COMPLETED)
                | THROW
                | GET_INSTANCE_FIELD
                | method? GET_STATIC_FIELD    
                | ARRAY_LOAD
                | ARRAY_STORE
                | PUT_INSTANCE_FIELD
                | PUT_INSTANCE_FIELD_BEFORE
                | PUT_STATIC_FIELD
                | NEW_ARRAY
                | MULTI_NEW_ARRAY
                | ARRAY_LENGTH
                | INSTANCEOF
</pre><ul>
<li><code>method?</code> is inserted between events when JVM loads a class and executes its static initializer (<code>&lt;clinit&gt;</code>).</li>
<li>An exception is recorded as <code>EVENT_CATCH</code>. If the previous event is one of <code>ARRAY_LOAD, GET_*_FIELD, CALL</code> events, the exception is likely caused by the operation.<ul>
<li>If there are no catch block, <code>METHOD_EXCEPTIONAL_EXIT</code> is found in a trace. <br  />
</li>
</ul>
</li>
<li>If labels are recorded in an execution trace (by specifying <code>-weave=ALL</code> option), label events are inserted between events.</li>
<li>Even if parameters are unrecorded (PARAM is not specified in -weave option), <code>RETURN_VALUE_AFTER_CALL</code> events with void type (without values) are recorded to indicate the end of a method call.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
What is not recorded in an execution trace?</h1>
<ul>
<li>Local variables are not recorded in a trace. You may recover the state by replaying an execution of a method from parameters of a method, array access events, and field access events. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">構築: <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
